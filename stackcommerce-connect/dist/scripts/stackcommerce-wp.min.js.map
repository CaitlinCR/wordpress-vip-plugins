{"version":3,"sources":["stackcommerce-wp.js"],"names":["jQuery","document","ready","querySelector","sc_connect","StackCommerce_WP","updateForm","select2","tags","tokenSeparators","minimumInputLength","addEventListener","notify","bind","keypress","performKeycheck","change","_classCallCheck","this","$endpoint","getValue","$form","$submit_button","_createClass","key","value","_this","$account_id","$secret_key","setConnectionStatus","ajax","method","url","processData","contentType","dataType","data","JSON","stringify","generatePayload","done","submit","fail","type","id","attributes","installed","wordpress_url","author_id","post_status","categories","getSelect2Values","featured_image","plugin_version","status","setValue","$connection_status","$content_integration","setAttribute","removeAttribute","e","which","$selector","default_value","arguments","length","undefined"],"mappings":"6XAAAA,OAAOC,UAAUC,MAAM,WAGrB,GAFmCD,SAASE,cAAc,0BAE3B,CAC7B,IAAIC,EAAa,IAAIC,iBAErBD,EAAWE,aAEXN,OAAO,gCAAgCO,SACrCC,MAAM,EACNC,iBAAkB,KAClBC,mBAAoB,IAGtBV,OAAO,0BAA0BO,SAC/BC,MAAM,EACNC,iBAAkB,KAClBC,mBAAoB,IAGDT,SAASE,cAAc,iCAE7BQ,iBAAiB,QAASP,EAAWQ,OAAOC,KAAKT,IAEhEJ,OAAO,8BAA8Bc,SAASV,EAAWW,gBAAgBF,KAAKT,IAC9EJ,OAAO,wDAAwDgB,OAAOZ,EAAWE,WAAWO,KAAKT,OAzBrG,IA6BMC,iBAAAA,WACJ,SAAAA,IAAcY,gBAAAC,KAAAb,GACZa,KAAKC,UAAiBD,KAAKE,SAAS,sCACpCF,KAAKG,MAAiBpB,SAASE,cAAc,0BAC7Ce,KAAKI,eAAiBrB,SAASE,cAAc,iCAwG9C,OAvGAoB,aAAAlB,IAAAmB,IAAA,SAAAC,MAAA,WAEQ,IAAAC,EAAAR,KACHS,EAAcT,KAAKE,SAAS,gCAC5BQ,EAAcV,KAAKE,SAAS,4BAEhCF,KAAKW,oBAAoB,cAEzB7B,OAAO8B,MACLC,OAAQ,MACRC,IAAKd,KAAKC,UAAY,sBAAwBQ,EAAc,WAAaC,EACzEK,aAAa,EACbC,YAAa,mBACbC,SAAU,OACVC,KAAMC,KAAKC,UAAUpB,KAAKqB,qBAE3BC,KAAK,WACJd,EAAKG,oBAAoB,aACzBH,EAAKL,MAAMoB,WAEZC,KAAK,WACJhB,EAAKG,oBAAoB,qBAE5BL,IAAA,kBAAAC,MAAA,WAYC,OACEW,MACEO,KAAM,6BACNC,GAZkB1B,KAAKE,SAAS,gCAahCyB,YACEC,WAAW,EACXC,cAdgB7B,KAAKE,SAAS,8BAe9B4B,UAdgB9B,KAAKE,SAAS,4BAe9B6B,YAdgB/B,KAAKE,SAAS,iCAe9B8B,WAdgBhC,KAAKiC,iBAAiB,mCAetC3C,KAdgBU,KAAKiC,iBAAiB,6BAetCC,eAdgBlC,KAAKE,SAAS,oCAe9BiC,eAdgBnC,KAAKE,SAAS,0CAkBrCI,IAAA,sBAAAC,MAAA,SAEmB6B,GAClBpC,KAAKqC,SAAS,sCAAuCD,GACrDpC,KAAKZ,gBACNkB,IAAA,aAAAC,MAAA,WAGC,IAAIJ,EAAuBpB,SAASE,cAAc,0BAC9CmB,EAAuBrB,SAASE,cAAc,iCAC9CqD,EAAuBtC,KAAKE,SAAS,uCACrCqC,EAAuBvC,KAAKE,SAAS,gEAEzCC,EAAMqC,aAAa,+BAAgCF,GACnDnC,EAAMqC,aAAa,4CAAsE,QAAxBD,GAEvC,eAAvBD,EACDlC,EAAeoC,aAAa,WAAY,YAExCpC,EAAeqC,gBAAgB,eAElCnC,IAAA,kBAAAC,MAAA,SAEemC,GACd,GAAc,IAAXA,EAAEC,MAEH,OADA3C,KAAKN,UACE,KAEVY,IAAA,WAAAC,MAAA,SAEQqC,GAA+B,IAApBC,EAAoBC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAJ,GAC9BvC,EAAQxB,SAASE,cAAc2D,GAAWrC,MAE9C,OAAGA,GAGMsC,KAEVvC,IAAA,mBAAAC,MAAA,SAEgBqC,GAA+B,IAApBC,EAAoBC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,MAC1CvC,EAAQzB,OAAO8D,GAAWvD,QAAQ,OAEtC,OAAGkB,GAGMsC,KAEVvC,IAAA,WAAAC,MAAA,SAEQqC,GAAuB,IAAZrC,EAAYuC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAJ,GAC1B/D,SAASE,cAAc2D,GAAWrC,MAAQA,MAC3CpB","file":"stackcommerce-wp.min.js","sourcesContent":["jQuery(document).ready(function() {\n  const isStackCommerceConnectPage = document.querySelector('.stackcommerce-wp-form');\n\n  if(isStackCommerceConnectPage) {\n    let sc_connect = new StackCommerce_WP();\n\n    sc_connect.updateForm();\n\n    jQuery('#stackcommerce_wp_categories').select2({\n      tags: true,\n      tokenSeparators: [','],\n      minimumInputLength: 3\n    });\n\n    jQuery('#stackcommerce_wp_tags').select2({\n      tags: true,\n      tokenSeparators: [','],\n      minimumInputLength: 3\n    });\n\n    let $submit_button = document.querySelector('#stackcommerce-wp-form-submit');\n\n    $submit_button.addEventListener('click', sc_connect.notify.bind(sc_connect));\n\n    jQuery('form.stackcommerce-wp-form').keypress(sc_connect.performKeycheck.bind(sc_connect));\n    jQuery('input[name=\"stackcommerce_wp_content_integration[]\"]').change(sc_connect.updateForm.bind(sc_connect));\n  }\n});\n\nclass StackCommerce_WP {\n  constructor() {\n    this.$endpoint      = this.getValue('#stackcommerce_wp_cms_api_endpoint');\n    this.$form          = document.querySelector('#stackcommerce-wp-form');\n    this.$submit_button = document.querySelector('#stackcommerce-wp-form-submit');\n  }\n\n  notify() {\n    let $account_id = this.getValue('#stackcommerce_wp_account_id'),\n        $secret_key = this.getValue('#stackcommerce_wp_secret');\n\n    this.setConnectionStatus('connecting');\n\n    jQuery.ajax({\n      method: 'PUT',\n      url: this.$endpoint + '/api/wordpress/?id=' + $account_id + '&secret=' + $secret_key,\n      processData: false,\n      contentType: 'application/json',\n      dataType: 'json',\n      data: JSON.stringify(this.generatePayload())\n    })\n    .done(() => {\n      this.setConnectionStatus('connected');\n      this.$form.submit();\n    })\n    .fail(() => {\n      this.setConnectionStatus('disconnected');\n    });\n  }\n\n  generatePayload() {\n    let $account_id     = this.getValue('#stackcommerce_wp_account_id'),\n        $wordpress_url  = this.getValue('#stackcommerce_wp_endpoint'),\n        $author_id      = this.getValue('#stackcommerce_wp_author'),\n        $post_status    = this.getValue('#stackcommerce_wp_post_status'),\n        $categories     = this.getSelect2Values('#stackcommerce_wp_categories', []),\n        $tags           = this.getSelect2Values('#stackcommerce_wp_tags', []),\n        $featured_image = this.getValue('#stackcommerce_wp_featured_image'),\n        $plugin_version = this.getValue('#stackcommerce_wp_plugin_version');\n\n    return {\n      data: {\n        type: 'partner_wordpress_settings',\n        id: $account_id,\n        attributes: {\n          installed: true,\n          wordpress_url: $wordpress_url,\n          author_id: $author_id,\n          post_status: $post_status,\n          categories: $categories,\n          tags: $tags,\n          featured_image: $featured_image,\n          plugin_version: $plugin_version\n        }\n      }\n    };\n  }\n\n  setConnectionStatus(status) {\n    this.setValue('#stackcommerce_wp_connection_status', status);\n    this.updateForm();\n  }\n\n  updateForm() {\n    let $form                = document.querySelector('#stackcommerce-wp-form'),\n        $submit_button       = document.querySelector('#stackcommerce-wp-form-submit'),\n        $connection_status   = this.getValue('#stackcommerce_wp_connection_status'),\n        $content_integration = this.getValue('input[name=\"stackcommerce_wp_content_integration[]\"]:checked');\n\n    $form.setAttribute('data-stackcommerce-wp-status', $connection_status);\n    $form.setAttribute('data-stackcommerce-wp-content-integration', ($content_integration == 'true' ? true : false));\n\n    if($connection_status === 'connecting') {\n      $submit_button.setAttribute('disabled', 'disabled');\n    } else {\n      $submit_button.removeAttribute('disabled');\n    }\n  }\n\n  performKeycheck(e) {\n    if(e.which == 13) {\n      this.notify();\n      return false;\n    }\n  }\n\n  getValue($selector, default_value = '') {\n    let value = document.querySelector($selector).value;\n\n    if(value) {\n      return value;\n    } else {\n      return default_value;\n    }\n  }\n\n  getSelect2Values($selector, default_value = []) {\n    let value = jQuery($selector).select2('val');\n\n    if(value) {\n      return value;\n    } else {\n      return default_value;\n    }\n  }\n\n  setValue($selector, value = '') {\n    document.querySelector($selector).value = value;\n  }\n}\n"]}